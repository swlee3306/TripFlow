---
description: Prometheus Exporter 작성 규칙(레지스트리, 네이밍, 라벨 전략)
globs:
  - "internal/**/metrics/**.go"
  - "**/*exporter*.go"
  - "**/*metrics*.go"
---

# PROMETHEUS EXPORTER RULES

**네이밍**
- metric_name은 `namespace_subsystem_metricname_unit` 형식 권장.
- counter는 `_total`, gauge는 생략 또는 `_value`, histogram/summary는 표준 사용.

**라벨 전략**
- 고카디널리티 라벨 금지(예: raw IP·UUID 다량). 필요한 경우 샘플다운/매핑.
- LB/장비 식별은 고정된 `device_id`, `lb_id`, `vendor`, `model` 정도로 제한.

**구현**
- 전역 default register 지양, **전용 `prometheus.NewRegistry()`** 사용 후 `promhttp.HandlerFor(registry, ...)`.
- 수집기(Collector)에서 블로킹 IO 금지. 채널/버퍼로 비동기 수집 + expose 단계는 non-blocking.
- OpenMetrics 텍스트 출력 시 HELP/TYPE 포함, 타임스탬프는 exporter가 결정 가능(일관성 유지). (스펙 요점 정리 참고)  [oai_citation:3‡cursor101.com](https://cursor101.com/cursor/rules?utm_source=chatgpt.com)
