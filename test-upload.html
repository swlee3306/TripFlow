<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파일 업로드 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .upload-area { border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 20px 0; }
        .upload-area.dragover { border-color: #007bff; background-color: #f8f9fa; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>파일 업로드 테스트</h1>
    
    <div class="upload-area" id="upload-area">
        <p>마크다운 파일을 선택하거나 드래그하세요</p>
        <input type="file" id="file-input" accept=".md,.markdown" style="display: none;">
        <button onclick="document.getElementById('file-input').click()">파일 선택</button>
    </div>
    
    <div id="file-info" style="display: none;">
        <p>선택된 파일: <span id="file-name"></span></p>
        <button id="upload-btn" disabled>업로드</button>
    </div>
    
    <div id="status"></div>

    <script>
        let selectedFile = null;
        
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const uploadBtn = document.getElementById('upload-btn');
        const status = document.getElementById('status');
        
        fileInput.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        uploadBtn.addEventListener('click', uploadFile);
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                processFile(file);
            }
        }
        
        function processFile(file) {
            // 파일 타입 검증
            const allowedTypes = ['.md', '.markdown'];
            const fileExt = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
            
            if (!allowedTypes.includes(fileExt)) {
                showStatus('error', '마크다운 파일만 업로드 가능합니다.');
                return;
            }
            
            selectedFile = file;
            fileName.textContent = file.name;
            fileInfo.style.display = 'block';
            uploadBtn.disabled = false;
        }
        
        async function uploadFile() {
            if (!selectedFile) {
                showStatus('error', '파일을 선택해주세요.');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            
            uploadBtn.disabled = true;
            uploadBtn.textContent = '업로드 중...';
            
            try {
                const response = await fetch('http://localhost:8080/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('success', `업로드 성공! 파일 ID: ${result.fileId}`);
                } else {
                    showStatus('error', result.message || '업로드 실패');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showStatus('error', '네트워크 오류: ' + error.message);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = '업로드';
            }
        }
        
        function showStatus(type, message) {
            status.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
    </script>
</body>
</html>
